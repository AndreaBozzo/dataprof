name: Quick Performance Check
on:
  pull_request:
    branches: [main, master, staging]
    paths:
      - 'src/**'
      - 'benches/**'
      - 'Cargo.toml'
  push:
    branches: [main, master, staging]
    paths:
      - 'src/**'
      - 'benches/**'
      - 'Cargo.toml'
  workflow_dispatch:

jobs:
  quick-performance-check:
    name: Quick Performance Validation
    runs-on: ubuntu-latest
    timeout-minutes: 8
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Rust
        uses: ./.github/actions/setup-rust
        with:
          cache-prefix: quick-benchmark

      - name: Environment health check
        run: |
          echo "üîç Environment health check..."
          rustc --version
          cargo --version
          echo "Available memory: $(free -h | grep '^Mem:' | awk '{print $7}')"
          echo "CPU cores: $(nproc)"

      - name: Build benchmark binaries
        run: |
          echo "üî® Building benchmark binaries..."
          timeout 300 cargo bench --no-run

      - name: Run quick benchmarks
        uses: ./.github/actions/benchmark-runner
        with:
          benchmark-type: unified
          mode: quick
          sample-size: 10
          measurement-time: 3
          timeout: 3

      - name: Run smoke test
        uses: ./.github/actions/benchmark-runner
        with:
          benchmark-type: domain
          mode: quick
          sample-size: 10
          measurement-time: 2
          timeout: 2

      - name: Report results
        run: |
          echo "‚úÖ Quick performance check completed in under 8 minutes"
          echo "‚ÑπÔ∏è  For comprehensive benchmarks, check the full benchmark workflow"