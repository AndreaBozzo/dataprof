name: Quick Performance Check
on:
  pull_request:
    branches: [main, master, staging]
    paths:
      - 'src/**'
      - 'benches/**'
      - 'Cargo.toml'
  push:
    branches: [main, master, staging]
    paths:
      - 'src/**'
      - 'benches/**'
      - 'Cargo.toml'

jobs:
  quick-benchmark:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - uses: actions/checkout@v4

      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable

      - name: Cache Cargo
        uses: actions/cache@v4
        with:
          path: |
            ~/.cargo/registry
            ~/.cargo/git
            target/
          key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}

      - name: Quick Benchmark Sample
        run: |
          echo "üöÄ Running quick performance check..."
          # Run statistical benchmark with quick settings (reduced measurement time)
          CRITERION_MEASUREMENT_TIME=5 cargo bench --bench statistical_benchmark

      - name: Performance Regression Check
        run: |
          echo "üìä Checking for major performance regressions..."
          # Basic smoke test with minimal measurement time
          CRITERION_MEASUREMENT_TIME=5 cargo bench --bench unified_benchmarks

      - name: Report Quick Results
        run: |
          echo "‚úÖ Quick performance check completed"
          echo "‚ÑπÔ∏è  For full benchmark results, check the scheduled comprehensive run"